# Conceitos do Node

## O que √© o Node.js?

- Javascript no back-end;
  - N√£o lidamos com eventos do usu√°rio final;
  - Rotas e integra√ß√µes;
- Plataforma (n√£o linguagem);
- Constru√≠da em cima da V8;
- Compar√°vel a PHP / Ruby / Python / Go;

## O que √© o NPM?

- Instalar bibliotecas de terceiros;
- Fornecer bibiotecas;
- Por que utilizaremos o Yarn?
  - Ele est√° avan√ßando mais r√°pido que o NPM em quest√£o de funcionalidades;
- Compar√°veis:
  - Composer do PHP;
  - Gems do Ruby;
  - PIP do Python;

## Caracter√≠sticas do Node

- Arquitetura Event-loop;
  - Baseada em eventos (Rotas na maioria das vezes);
  - Call Stack;
- Node single-thread;
- C++ por tr√°s com libuv;
- Background threads;
- Non-blocking I/O;

<p align="center">
  <img src="../readme/call-stack.png" width="404" height="416">
</p>

## Frameworks

- ExpressJS como base:
  - Sem opini√£o;
  - √ìtimo para iniciar;
  - Micro-servi√ßos;
- Frameworks opinados:
  - AdonisJS;
  - NestJS;

# Conceitos API REST

## Como funciona?

- Fluxo da requisi√ß√£o e resposta:
  - Requisi√ß√£o feira por um cliente;
  - Resposta retornada atrav√©s de uma estrutura de dados;
  - Cliente recebe resposta e processa resultado;
  - As rotas utilizam m√©todos HTTP:
    - <span style="color: #75f3d0;">GET</span> http://minhaapi.com/<span style="color: #BB227B;">users</span>
    - <span style="color: #75f3d0;">POST</span> http://minhaapi.com/<span style="color: #BB227B;">users</span>
    - <span style="color: #75f3d0;">PUT</span> http://minhaapi.com/<span style="color: #BB227B;">users</span>/<span style="color: #EDBE00;">1</span>
    - <span style="color: #75f3d0;">DELETE</span> http://minhaapi.com/<span style="color: #BB227B;">users</span>/<span style="color: #EDBE00;">1</span>

<p align="center">
  <img src="../readme/routes-resources.png">
</p>

## Benef√≠cios

- M√∫ltiplos clientes (front-end), mesmo back-end;
- Protocolo de comunica√ß√£o padronizado (JSON);
  - Mesma estrutura para web / mobile / API p√∫blica;
  - Comunica√ß√£o com servi√ßos externos;

## Conte√∫do da requisi√ß√£o

<p align="center">
  <img src="../readme/request-content.png" width="572" height="232">
</p>

## HTTP Codes

- <span style="color: #5097C2;">1xx</span>: Informational
- <span style="color: #489C8E;">2xx: Success
  - 200: SUCCESS
  - 201: CREATED
- <span style="color: #AD4A81;">3xx</span>: Redirection
  - 301: MOVED PERMANENTLY
  - 302: MOVED
- <span style="color: #E4C547;">4xx</span>: Client Error
  - 400: BAD REQUEST
  - 401: UNAUTHORIZED
  - 404: NOT FOUND
- <span style="color: #EF6E64;">5xx</span>: Server Error
  - 500: INTERNAL SERVER ERROR

> üí° BORA CODAR!

# Criando projeto Node

- Criar pasta para o projeto;
- Navegar at√© a pasta no terminal;
- Executar `yarn init -y` para iniciar o projeto;
  - O comando acima vai criar o `package.json` , um arquivo que guarda algumas informa√ß√µes sobre o projeto;
- Abrir o projeto no VS Code com `code .`;
  - Caso n√£o tenha o comando `code .` reconhecido no terminal:
    - Abra uma janela do VS Code;
    - Aperte `Ctrl` + `Shift` + `P` (ou `Cmd` + `Shift` + `P` );
    - Pesquise e selecione a op√ß√£o: `Install 'code' command in PATH` ;
- Crie uma pasta `src` dentro do projeto;
- Dentro da `src` crie um `index.js` ;
- No terminal execute `yarn add express` para instalar o Express;
- No arquivo `index.js` insira o c√≥digo:

```jsx
// Importa o Express instalado
const express = require('express');

// Cria uma inst√¢ncia do Express
const app = express();

// Cria uma rota acess√≠vel pelo m√©todo GET e com o endere√ßo /projects
app.get('/projects', (request, response) => {
  // Retorna para o cliente uma mensagem em formato de texto
  return response.send('Hello World');
});

// Define que a aplica√ß√£o vai rodar na porta 3333, por exemplo:
// http://localhost:3333
app.listen(3333);
```

- Para executar o c√≥digo, execute no terminal: `node src/index.js` ;
- Abra o Browser e acesse: `http://localhost:3333/projects` ;
- Modifique o `/projects` para `/` para poder acessar com o endere√ßo `http://localhost:3333` ;
- Troque o `.send('Hello World')` por `.json({ message: 'Hello World' })` para que o retorno seja sempre no padr√£o JSON;
- Para ver o funcionamento, pare a execu√ß√£o no terminal com `Ctrl` + `C` e execute novamente `node src/index.js` ;
- Para finalizar acesse `http://localhost:3333` e veja o resultado;
- N√£o usamos o `request` da rota pois √© nele onde ficam armazenadas as informa√ß√µes da rota acessada, tal como os dados enviados pelo usu√°rio, veremos como fazer uso dela nas pr√≥ximas aulas;

# Configurando Nodemon

- O Nodemon √© uma ferramenta utilizada por toda comunidade Node para fazer a atualiza√ß√£o autom√°tica do servidor quando o Node detectar uma  altera√ß√£o no c√≥digo;
- Instalar o Nodemon executando `yarn add nodemon -D` para instalar como depend√™ncia de desenvolvimento;
- H√° 2 maneiras de se executar o Nodemon;
  - A primeira e mais comum √© executando no terminal `nodemon src/index.js` no terminal;
  - A segunda maneira √©:
    - Criar um √≠ndice `scripts` no `package.json`;
    - Dentro do `scripts` inserir o √≠ndice `"dev": "nodemon"`;
    - No √≠ndice `main` modificar o valor para ficar: `"main": "src/index.js"`;
    - Executar no terminal `yarn dev`;
- Modificar a `message` de `Hello World` para `Hello GoStack` e salvar para ver o resultado;
- Adicionar uma arrow function no segundo par√¢metro da fun√ß√£o `app.listen` para que uma mensagem seja disparada automaticamente sempre que o servidor for reiniciado, ficando dessa forma:
  ```javascript
  app.listen(3333, () => {
    console.log('üöÄ Back-end started!');
  });
  ```
- Ao salvar o arquivo o resultado deve ser aparente no terminal, com o servidor reiniciando automaticamente;

# M√©todos HTTP

- M√©todos HTTP:
  - GET: Buscar informa√ß√µes do Back-end;
  - POST: Criar uma informa√ß√£o no Back-end;
  - PUT/PATCH: Alterar uma informa√ß√£o no Back-end;
  - DELETE: Deletar uma informa√ß√£o no Back-end;
- Criar 4 rotas novas, uma com cada m√©todo;
  - Modificar a rota j√° criada com o m√©todo GET para ficar como abaixo:
    ```javascript
    app.get('/projects', (request, response) => {
      return response.json([
        'Projeto 1',
        'Projeto 2',
      ]);
    });
    ```
  - Criar uma nova rota com m√©todo POST com o c√≥digo:
    ```javascript
    app.post('/projects', (request, response) => {
      return response.json([
        'Projeto 1',
        'Projeto 2',
        'Projeto 3',
      ]);
    });
    ```
    - Rotas com m√©todo POST n√£o podem ser testadas diretamente no navegador sem ser feito uma "gambiarra";
  - Criar uma nova rota com o m√©todo PUT com o c√≥digo:
    ```javascript
    app.put('/projects/:id', (request, response) => {
      return response.json([
        'Projeto 4',
        'Projeto 2',
        'Projeto 3',
      ]);
    });
    ```
    - O `:id` na rota indica que √© um par√¢metro que vai ser passado na chamada daquela rota;
    - Rotas com m√©todo PUT tamb√©m n√£o podem ser testadas diretamente no navegador;
  - Criar uma nova rota com o m√©todo DELETE com o c√≥digo:
    ```javascript
    app.delete('/projects/:id', (request, response) => {
      return response.json([
        'Projeto 2',
        'Projeto 3',
      ]);
    });
    ```
    - O `:id` na rota indica que √© um par√¢metro que vai ser passado na chamada daquela rota;
    - Rotas com m√©todo DELETE tamb√©m n√£o podem ser testadas diretamente no navegador;

# Utilizando Insomnia

- Acessar, baixar e instalar o Insomnia ([https://insomnia.rest](https://insomnia.rest/));
- Instalar o Tema Dracula para o Insomnia ([https://draculatheme.com/insomnia/](https://draculatheme.com/insomnia/));
- Criar um novo `Workspace`;

<p align="center">
  <img src="../readme/create-workspace.png" width="641" height="527">
</p>

- Criar um `Folder` para cada tipo de recurso, inicialmente criar um para `Projects`;

<p align="center">
  <img src="../readme/create-folder.png" width="641" height="527">
</p>

- Criar uma `Request` dentro da Folder, clicando em `click to add first request...` , dar o nome de `List` e manter o m√©todo `GET`;

<p align="center">
  <img src="../readme/create-request.png" width="641" height="527">
</p>

- Inserir na barra de endere√ßo a URL da aplica√ß√£o Node e dar um `Send`;

<p align="center">
  <img src="../readme/send-request.png" width="641" height="527">
</p>

- O retorno deve ser igual ao retorno do browser;
- Duplicar a rota criada anteriormente e mudar o m√©todo para `POST` e o nome para `Create`, feito isso dar um `Send` novamente;

<p align="center">
  <img src="../readme/duplicate-request.png" width="641" height="527">
</p>

- Duplicar novamente a rota e mudar o m√©todo para `PUT` e o nome para `Update` , ao tentar enviar vai ocorrer um erro, pois essa rota espera um `id` como par√¢metro, basta inserir ao final da URL da aplica√ß√£o o seguinte: `/1` e dar um `Send`;

<p align="center">
  <img src="../readme/put-request.png" width="641" height="527">
</p>

- Duplicar a rota `Update` , mudar apenas o m√©todo para `Delete` e dar um `Send` novamente;
- Criar um novo `Environment`;

<p align="center">
  <img src="../readme/create-environment.png" width="641" height="527">
</p>

  - Os `Environments` s√£o usados para separar as rotas para testar a aplica√ß√£o local e tamb√©m online;
- Criar um `Sub Environment` com nome `dev` ;

<p align="center">
  <img src="../readme/create-sub-environment.png" width="641" height="527">
</p>

  - Pra renomear o `Sub Environment` criado basta dar 2 cliques sobre o nome;
- Criar a vari√°vel `base_url` no `Sub Environment` criado, ficando assim:
  ```json
  {
    "base_url": "http://localhost:3333"
  }
  ```
- Clicar em `Done` para salvar o `Environment`;
- Clicar no aviso `No Environment` e selecionar o `dev` criado anteriormente;

<p align="center">
  <img src="../readme/select-environment.png" width="641" height="527">
</p>

- Trocar nas rotas criadas a URL `http://localhost:3333` por `base_url`;

<p align="center">
  <img src="../readme/change-url.png" width="641" height="527">
</p>

  - Ao come√ßar a digitar `base_url` o Insomnia ir√° sugerir a vari√°vel criada no `Environment`;

# Tipos de Par√¢metros

## Tipos de Par√¢metros

- Query Params: Filtros e pagina√ß√£o;
  - Passado atrav√©s das URL:
    ```
    http://localhost:3333/projects?title=React&owner=Diego
    ```
  - No Insomnia h√° uma aba espec√≠fica para isso:

<p align="center">
  <img src="../readme/query-params.png" width="641" height="527">
</p>

- Route Params: Identificar recursos (Atualizar/Deletar);
  - Passado atrav√©s da URL:
    ```
      http://localhost:3333/projects/1
    ```
    - Esse tipo de par√¢metro j√° foi usado nas rotas com os m√©todos `PUT` e `DELETE` para passar o id;
- Request Body:Conte√∫do na hora de criar ou editar um recurso (JSON);
  - No Insomnia h√° como inserir um corpo na requisi√ß√£o:
  - Inserir no Body da requisi√ß√£o `Create` no Insomnia o seguinte conte√∫do:
    ```json
    {
      "title": "Aplicativo React Native",
      "owner": "Diego Fernandes"
    }
    ```

## Modificando a aplica√ß√£o

- Inserir na rota `/projects` com m√©todo `GET` o c√≥digo abaixo:
  ```jsx
  app.get('/projects', (request, response) => {
    // Recupera do request.query as vari√°veis title e owner
    const { title, owner } = request.query;

    // Printa no terminal as vari√°veis recuperadas;
    console.log(title);
    console.log(owner);

    // ...
  });
  ```
- Inserir na rota `/projects/:id` com m√©todo `PUT` o c√≥digo abaixo:
  ```jsx
  app.put('/projects/:id', (request, response) => {
    // Recupera do request.params a vari√°vel id
    const { id } = request.params;

    // Printa no terminal a vari√°vel recuperada
    console.log(id);

    // ...
  });
  ```
- Adicionar o Middleware do Express para entender o formato do Body como JSON:
  - Inserir logo no come√ßo do arquivo `index.js` o seguinte:
    ```jsx
    import express from 'express';

    const app = express();

    // Middleware que vai garantir o parse do request.body para JSON
    app.use(express.json());

    // ...
    ```
- Inserir na rota `/projects` com m√©todo `POST` o c√≥digo abaixo:
  ```jsx
  app.post('/projects', (request, response) => {
    // Recupera do request.body as vari√°veis title e owner
    const { title, owner } = request.body;

    // Printa no terminal as vari√°veis recuperadas;
    console.log(title);
    console.log(owner);

    // ...
  });
  ```
